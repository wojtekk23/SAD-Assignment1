---
title: "Zadanie zaliczeniowe 1"
author: "Wojciech Kłopotek"
date: "29 04 2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Treść zadania

**Celem** zadania jest staystyczna analiza danych znajdujących się w pliku `people.tab`.

**Dane:** Są to dane symulowane; opisują wiek (zmienna `age`), wagę (`weight`), wzrost (`height`), płeć (`gender`), stan cywilny (`married`), liczbę dzieci (`number_of_kids`), posiadane zwierzę domowe (`pet`) oraz miesięczne wydatki (`expenses`) pewnych osób. We wszystkich zadaniach poniżej zmienna `expenses` jest **zmienną objaśnianą** (zależną), a pozostałe zmienne są **zmiennymi objaśniającymi** (niezależnymi).

**Wynikiem** ma być raport w formacie .Rmd oraz skompilowany do html. Raport w obydwu formatach należy przesłać na adres email do prwoadzącego laboratorium do sprawdzenia.

# Zadanie 1

*Wczytaj dane, objerzyj je i podsumuj w dwóch-trzech zdaniach. Pytania pomocnicze: ile jest obserwacji, ile zmiennych ilościowych, a ile jakościowych? Czy są zależności w zmiennych objaśniających (policz i zaprezentuj na wykresach korelacje pomiędzy zmiennymi ilościowymi), a także zbadaj zależność zmiennych jakościowych. Skomentuj wyniki. Czy występują jakieś braki danych?*

```{r}
df <- read.csv("people.tab", sep="\t")
```

Zbiór danych zawiera `r nrow(df)` obserwacji, 3 zmienne jakościowe i 5 zmiennych ilościowych.

```{r}
library(ggplot2)
library(GGally)

#ggpairs(df[,-which(colnames(df)=='expenses')], aes(col=gender))
ggpairs(df, aes(col=gender), columns = c(1,2,3,6,8))
```


Widzimy statystycznie znaczące korelacje między zmiennymi `expenses` i `age` (wydatkami a wiekiem) oraz `height` i `weight` (wzrostem i wagą) dla zagregowanych danych oraz dla wszystkich płci osobno. Powyższe wykresy wskazują na to, że wiek jest znacząco skorelowany z wydatkami.

```{r}
ggpairs(df[,c(4,5,7)])
```

W danych występują pojedyncze braki:
```{r}
colSums(is.na(df))
```

Konkretnie zbiór danych zawiera `r length(which(rowSums(is.na(df)) > 0))` wybrakowanych wierszy.

# Zadanie 2

***Podsumuj dane przynajmniej trzema różnymi wykresami**. Należy przygotować:*

* *wykres typu scatter-plot (taki jak na wykładzie 6, slajd 3) dla wszystkich zmiennych objaśniających ilościowych i zmiennej objaśnianej*
* *Wykresy typu pudełkowy (boxplot) dla jednej wybranej zmiennej ilościowej.*
* *Wykres typu słupkowy (barplot) dla jednej wybranej zmiennej jakościowej.*

*Mile widziane dodatkowe wykresy wg własnej inwencji (np. histogram, punktowy, liniowy, mapa ciepła, ...)*

```{r}
pairs(~ age + weight + height + number_of_kids + expenses, data = df, col = 'blue', pch='.')
```

```{r}
library(ggplot2)

ggplot(df) + geom_boxplot(aes(y = age))
```

```{r}
# Usuwamy niepoprawny wiersz
ggplot(df[-nrow(df),]) + geom_bar(aes(x = pet))
```

```{r}
df = df[-which(rowSums(is.na(df)) > 0),]
```

# Zadanie 3

***Policz p-wartości dla hipotez o wartości średniej $m = 170$ i medianie $me = 165$ (cm)** dla zmiennej $wzrost$. Wybierz statystykę testową dla alternatywy lewostronnej, podaj założenia, z jakich korzystałeś i skomentuj, czy wydają Ci się uprawnione*

Założę, że średnia zmiennej $wzrost$ ma rozkład normalny, ze względu na to, że obserwacje pochodzą z tego samego rozkładu i są niezależne, więc ze względu na dużą ich liczbę (`r nrow(df)` > 30) możemy użyć Centralnego Twierdzenia Granicznego. Ze względu na to, że nie znamy wariancji populacji, ale liczność próby jest liczna ($n = $`r nrow(df)`) użyjemy wariancji próby i policzymy statystykę testową dla standardowego rozkładu normalnego:

$$
Z = \frac{\bar{X} - m}{S_n}\sqrt{n} \sim U
$$

```{r}
m <- 170
n <- nrow(df)
S_n <- sqrt((n-1)/n) * sd(df$height)
Z <- (mean(df$height) - m) / S_n * sqrt(nrow(df))
pnorm(Z)
```

Dla mediany możemy przeprowadzić test Wilcoxona dla jednej próby

```{r}
wilcox.test(df$height, mu=165)
```

# Zadanie 4
***Policz dwustronne przedziały ufności** na poziomie $0.99$ dla zmiennej $wiek$ dla następujących parametrów rozkładu:*
1. *średnia i odchylenie standardowe*
2. *kwantyle $\frac{1}{4}$, $\frac{2}{4}$ i $\frac{3}{4}$*
*Podaj założenia, z jakich korzystałeś i skomentuj, czy wydają Ci się uprawnione.*

## Przedziały ufności dla średniej

Jeśli $P\left(\frac{\bar{X}-\mu}{S_n}\sqrt{n} \in (\pm z_{0.995})\right) = 0.99$, to: $P\left(\mu \in (\bar{X} \mp z_{0.995})\right) = 0.99$

```{r}
n <- nrow(df)
S_n <- sqrt((n-1)/n) * sd(df$age)

show(c(mean(df$age) - S_n / sqrt(n) * qnorm(0.995), mean(df$age) + S_n / sqrt(n) * qnorm(0.995)))
```

## Przedziały ufności dla wariancji

Z wykresu Q-Q plot dla zmiennej $wiek$ wynika, że ma ona rozkład normalny. (Wykres jest liniowy)

```{r}
qqnorm(df$age)
```

Zakładając, że obserwacje wieku są niezależne, możemy zauważyć, że $P \left( \frac{nS_n^2}{\sigma^2} \in (\chi^2(0.005), \chi^2(0.995))\right) = 0.99$, więc: $P \left( \sigma^2 \in \left( \frac{nS_n^2}{\chi^2(0.995)}, \frac{nS_n^2}{\chi^2(0.005)} \right) \right) = 0.99$

```{r}
n <- nrow(df)
S2 <- (n-1) / n * var(df$age)

show(c( n*S2 / qchisq(0.995, n-1), n*S2 / qchisq(0.005, n-1) ))
```

## Kwantyle

Korzystając z założenia, że zmienna $wiek$ ma rozkład normalny, możemy

```{r}
quantile(df$age)
```
